## 개요

당근 알바 메인 배너 기능을 개선하며, 사용자 권한(role)에 따라 배너를 다르게 노출하고 우선순위를 설정할 수 있는 시스템을 설계하고 구현했습니다.
근시일 어드민 개편을 대비해 유연한 대응과 관리 편의성을 고려해 Redis 기반의 캐시 구조를 도입했습니다.
어드민 화면에서는 배너 CRUD 및 권한별 정렬 기능을 제공하고, 앱 메인화면에서 호출하는 배너 조회 API를 구현했습니다.

## 문제상황

기존에는 마케팅 배너를 프론트엔드 코드에 하드코딩하여 등록했기 때문에, 배너 변경 시마다 개발 리소스가 반복적으로 투입되고 매번 배포가 필요했습니다. 마케터가 관리자 페이지를 통해 직접 배너를 등록하고 관리할 수 있도록 개편해야 했으며, 이에 따라 UI/UX 설계, 백엔드 로직, 어드민 기능 구현을 전반적으로 담당했습니다.

## 개선 목표

- 사용자 권한에 따라 노출할 배너를 정렬
- 마케터가 어드민 페이지에서 직접 배너를 등록/수정/삭제할 수 있도록 지원
- 어드민 기능 개편 및 구조 변경에 유연하게 대응할 수 있도록 Redis 기반으로 구현
- 노출 시간을 서버 시간 기준으로 판단하여 자동 적용되도록 처리

## 해결 전략

### Redis 구조 설계

Redis는 성능보다 구조의 유연성과 운영 편의성을 고려해 도입했습니다. 배너 수량이 적고 노출 기간이 명확하다는 특성상, DB에 영속화하기보다는 Redis를 임시 저장소이자 정렬 도구로 활용하는 것이 적합하다고 판단했습니다.

- 배너 상세 정보: `Hash` 구조 (`Banner#detail:{bannerId}`)
  - 장점: 필드 단위 접근과 수정이 가능하여 유지보수가 용이함
  - 대안: `String`에 JSON 직렬화 → 특정 필드 접근이 어려워 유연성 부족
- 권한별 배너 순서: `SortedSet` 구조 (`Banner#order:{userRole}`)
  - 장점: score 기반 정렬 지원, 삽입/삭제 연산 효율적
  - 대안: `List` 구조 → 정렬 기준 유지가 어렵고 변경 시 오버헤드 발생
- 고려했던 대안: `SortedSet`의 score에 timestamp를 활용하여 시간 조건까지 Redis에서 처리
  - 단점: 시간과 우선순위를 동시에 표현하는 데 제약이 존재
  - 결론: 시간 조건은 서버에서 필터링하고, Redis는 정렬 전용으로 분리 활용

### 앱 메인화면 배너 조회 API

앱 메인화면 진입 시, 서버는 현재 시각과 사용자 권한을 기준으로 배너 목록을 반환하는 API를 제공합니다. 이 API는 다음 기준을 기반으로 배너를 필터링하고 정렬합니다.

- 현재 서버 시각이 배너의 노출 시작 및 종료 시간 범위에 포함되는지 확인
- 사용자 권한에 따라 Redis의 `SortedSet`에서 노출 우선순위에 맞는 배너 ID 목록 조회
- 각 배너의 상세 정보를 `Hash`에서 불러와 정렬된 리스트로 응답 구성

이를 통해 클라이언트는 실시간으로 유효한 배너만 렌더링할 수 있으며, Redis 캐시를 활용해 빠른 응답성과 정확한 노출이 가능합니다.

### GraphQL Mutation 및 어드민 기능 구현

- 배너 등록 시 고유한 `eventKind` 생성 및 필수 입력값 유효성 검증
- 배너 타입(default/full-image)에 따른 입력 필드 UI 분기 처리
- 이미지 비율, 텍스트 길이 제한 등 콘텐츠 품질 유지를 위한 검증 로직 구현
- 어드민 화면에서 ▲▼ 버튼 클릭으로 권한별 배너 노출 순서 조정 기능 제공
- 노출 기간이 지난 배너는 서버에서 자동으로 미노출 처리

## 성과

- Redis와 서버의 역할을 명확히 분리하여 유연한 구조와 정확한 조건 필터링을 모두 달성
- 어드민 기능 확장 및 구조 변경에 유연하게 대응 가능한 시스템 설계
- 마케터가 개발 리소스 없이 배너를 자율적으로 운영할 수 있게 되었으며, 해당 기능은 안정적으로 실서비스에서 활용됨
- 노출 시간 조건을 코드에서 관리함으로써 운영자가 별도로 배너 상태를 제어하지 않아도 실시간으로 정확한 노출이 가능해짐

## 사용 기술 및 도구

- **Backend** : Node.js, GraphQL
- **Infra** : Redis
- **Admin** : React (배너 우선순위 UI 포함)

## 개인 기여

- Redis 자료구조 설계 및 role/시간 조건 분리 전략 수립
- GraphQL 기반의 배너 생성/수정/삭제 Mutation 설계 및 유효성 검사 로직 구현
- 어드민 화면 내 권한별 배너 정렬 기능 기획 및 프론트엔드 개발자와 협업하여 UI 구현 주도
- 배너 타입별 입력 조건 처리 및 실사용자 피드백 반영을 통한 개선 주도

## 회고

이 프로젝트에서 요구사항에 맞는 Redis 자료구조를 선택하며 트레이드오프를 고민했습니다. Redis는 속도 측면에서 유리하지만 복잡한 기능 구현에는 제약이 있었고, 각 자료구조의 장단점을 비교하며 목적에 맞는 구조를 선택해야 했습니다.
퇴사 당일, 팀원분이 알파서버에 롤링페이퍼를 담은 배너를 띄워주셨습니다. 제가 구현한 기능이 동료 간의 인사를 전하는 수단으로도 쓰였다는 사실에 깊은 인상을 받았고, 감사함을 느꼈습니다.
